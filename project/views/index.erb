<%if logged_in? %>
  <h2>Hello, <span class="username"><%= current_user.firstname %>.</span></h2>
    
    <h3>Some time ago, during one of your birthdays:</h3>
    <div class="article_content">
      <h4 class="article-title"></h4> 
      <p class="date"></p>
      <p class="result"></p>
    </div>

  <h2 class="jump-in">Let's Jump in!</h2>
  <a class="get-my-articles" href="/articles/<%= current_user.id%>">Search articles based on my Birthday</a>
  <div class="chooseDate">
    <form class="custom-date" action="/articles/guest">
      <h3>For someone else? Please enter the date.</h3>
      <div class="select-date">
        <select name="year" id="years" class="select"></select>
        <select name="month" id="months" class="select"></select>
        <select name="day" id="days" class="select"></select>
        <button class="go-btn">GO</button>
      </div>
    </form>
  </div>
<%else%>
  <div class="index">
    <h2>Hello!</h2> 
    <h1 class="welcome">Welcome to WHYB!</h1>
    <h3 class="pronounced">*(pronounced: <span class="noun">Why-Bee</span>)*</h3>
    <p>Have you ever wondered about what happened on your birthday 3 years ago?</p> 
    <p>How about 10 years ago?</p>
    <p>How about the day that you were born?</p>
    <p>This is a website where you can view articles that were published on your birthday dating back to your year of birth.</p>
    <p>Jump in to read blasts from the past!</p>
  </div>
  <h2 class="login-btn"><a href="/log_in">Log In</a></h2>
  <h2 class="signup-btn"><a href="/sign_up">Sign Up</a></h2>
<%end%>

<script src="/javascripts/options.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
  const articleContent = document.querySelector('.article_content')
  const title = document.querySelector('.article-title')
  const publishedDate = document.querySelector('.date')
  const result = document.querySelector('.result')

  const currentYear = new Date().getFullYear()
  const defaultDate = new Date()
  const defaultMonth = (defaultDate.getMonth())+1
  const defaultDay = defaultDate.getDate(<%=@day%>)
  var category = ["science", "arts", "technology", "real-estate", "health", "food", "business", "sports", "style", "world"]

  function getArticle() {
    var randomYear = Math.floor(Math.random() * (2019 - 1850 + 1)) + 1850;
    var randomCategory = category[Math.floor(Math.random()*category.length)];
    fetch(`https://api.nytimes.com/svc/search/v2/articlesearch.json?q=${randomCategory}&fq=pub_date:${randomYear}-${defaultMonth}-${defaultDay}&api-key=EXHiMpBT0AdjyWCGX1Gbq7mygBVEMgfr`)
    .then(res => res.json())
    .then(data => {
      
      if(data.response.docs[0] === '' || data.response.docs[0].headline.main === '' || data.response.docs[0].snippet === '') {
        getArticle()
      } else{

      const anchor = document.createElement('a')
      anchor.setAttribute('href', data.response.docs[0].web_url)
      anchor.textContent = "[...]"
      title.textContent = data.response.docs[0].headline.main
      result.textContent = data.response.docs[0].snippet.slice(0, -3) + ' '
      result.appendChild(anchor)
      publishedDate.textContent = data.response.docs[0].pub_date.slice(0,10).replace(/-/g, " ")}
    })
  }

  window.addEventListener('load', getArticle)
</script>